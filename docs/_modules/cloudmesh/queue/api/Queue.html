

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cloudmesh.queue.api.Queue &mdash; Cloudmesh v4 alpha documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Cloudmesh v4
          

          
          </a>

          
            
            
              <div class="version">
                4.0.28
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">PREFACE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../preface/about.html">1. About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../preface/contributors.html">2. Contributors</a></li>
</ul>
<p class="caption"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/install.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/quickstart.html">2. Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration/configuration.html">3. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/mongo.html">4. Cloudmesh Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration/encryption.html">5. Cloudmesh Yaml file Encrytion</a></li>
</ul>
<p class="caption"><span class="caption-text">SOMMAND SHELL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../cmd5.html">1. Cmd5</a></li>
</ul>
<p class="caption"><span class="caption-text">CLOUD SERVICES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../group.html">1. Group command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vm/vm.html">2. Virtual Machine Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vm/image.html">3. Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vm/flavor.html">4. Flavors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../storage/storage.html">5. Cloudmesh Multi Cloud Storage Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../workflow.html">6. Infrastructure Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../jupyter.html">7. Jupyter Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hpc/batch.html">8. Batch</a></li>
</ul>
<p class="caption"><span class="caption-text">openapi</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../openapi/README-storage-openapi.html">1. Cloudmesh Multi Cloud Open API Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../openapi/ufo.html">2. REST Service (outdated)</a></li>
</ul>
<p class="caption"><span class="caption-text">MANUAL PAGES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference-card.html">1. Reference Card (proposed)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual/commands.html">2. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-cmd5.html">3. Manual Cmd5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-group.html">4. Manual Group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-compute.html">5. Compute Manual Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-storage.html">6. Storage Manual Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-other.html">7. Manual Other</a></li>
</ul>
<p class="caption"><span class="caption-text">DATABASE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../storage/database.html">1. Cloudmesh Database</a></li>
</ul>
<p class="caption"><span class="caption-text">BENCHMARKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmarks/README.html">1. Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmarks/awsec2-vm-management-benchmark.html">2. AWS EC2 VM Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmarks/awsec2_benchmark_ubuntu.html">3. AWS EC2 VM Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmarks/awss3-storage-benchmark.html">4. AWS S3 File Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmarks/azure-storage-benchmark.html">5. Azure Blob Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmarks/box.html">6. Benchmark results for box Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmarks/emr.html">7. AWS EMR Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmarks/test_compute_database.html">8. AWS EC2 Compute Database</a></li>
</ul>
<p class="caption"><span class="caption-text">CODE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/code.html">1. Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/common.html">2. Common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/cmd5.html">3. CMD5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/cloudmesh.html">4. Cloudmesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/management.html">5. Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/mongo.html">6. Mongo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/commands.html">7. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/inventory.html">8. Inventory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/storage.html">9. cloudmesh-storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/cloud.html">10. cloudmesh-cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/batch.html">11. cloudmesh-batch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/emr.html">12. cloudmesh-emr</a></li>
</ul>
<p class="caption"><span class="caption-text">CONTRIBUTION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/conventions.html">1. Code Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/management.html">2. Code Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/management.html#documentation-management">3. Documentation Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/management.html#version-management">4. Version Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/pytest.html">5. Pytest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/todo.html">6. ToDo</a></li>
</ul>
<p class="caption"><span class="caption-text">CLOUD ACCOUNTS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/aws.html">1. AWS Account Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/azure.html">2. Azure Account Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/google.html">3. Google Storage Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/box.html">4. Box Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/accountcreation-old.html">5. VM Providers (outdated)</a></li>
</ul>
<p class="caption"><span class="caption-text">Outdated:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../CM4README.html">1. CM4 Details (outdated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vcluster.html">2. Virtual Cluster (in progress)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Cloudmesh v4</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>cloudmesh.queue.api.Queue</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cloudmesh.queue.api.Queue</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">Manager</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">ntpath</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">cloudmesh.management.configuration.config</span> <span class="k">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">cloudmesh.management.configuration.generic_config</span> <span class="k">import</span> <span class="n">GenericConfig</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.util</span> <span class="k">import</span> <span class="n">path_expand</span>
<span class="kn">from</span> <span class="nn">cloudmesh.mongo.DataBaseDecorator</span> <span class="k">import</span> <span class="n">DatabaseUpdate</span>
<span class="kn">from</span> <span class="nn">cloudmesh.mongo.CmDatabase</span> <span class="k">import</span> <span class="n">CmDatabase</span>
<span class="kn">from</span> <span class="nn">cloudmesh.management.configuration.name</span> <span class="k">import</span> <span class="n">Name</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.console</span> <span class="k">import</span> <span class="n">Console</span>
<span class="kn">from</span> <span class="nn">cloudmesh.batch.api.Batch</span> <span class="k">import</span> <span class="n">SlurmCluster</span>
<span class="kn">from</span> <span class="nn">cloudmesh.management.configuration.counter</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">munch</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.console</span> <span class="k">import</span> <span class="n">Console</span>
<span class="kn">from</span> <span class="nn">pymongo</span> <span class="k">import</span> <span class="n">cursor</span>


<span class="c1"># noinspection PyPep8</span>
<div class="viewcode-block" id="Queue"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue">[docs]</a><span class="k">class</span> <span class="nc">Queue</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Queue class</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cm_config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">munch</span><span class="o">.</span><span class="n">munchify</span><span class="p">({</span>
            <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;cloud&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;batch-queue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;cm&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;queue&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;policy&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;charge&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;numJobs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;numRunningJobs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;joblist&#39;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="c1"># list of parameters that can be set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settable_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;policy&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">CmDatabase</span><span class="p">()</span>


    <span class="nd">@DatabaseUpdate</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">queue_name</span><span class="p">,</span>
               <span class="n">cloud_name</span><span class="p">,</span>
               <span class="n">policy</span><span class="p">,</span>
               <span class="n">charge</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">unit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used to create a queue</span>

<span class="sd">        :param queue_name: name of the queue to create</span>
<span class="sd">        :param cloud_name: slurm cluster on which the job is gonna run</span>
<span class="sd">        :param policy: policy of the queue</span>
<span class="sd">        :param charge: charge of the queue</span>
<span class="sd">        :param unit: unit of the charge for the queue</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">Name</span><span class="p">(</span>
            <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cloud&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">cloud</span><span class="o">=</span><span class="n">cloud_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">queue_name</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">cloud</span><span class="o">=</span><span class="n">cloud_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">queue_name</span><span class="p">)</span>
        <span class="c1"># print(uid)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">munch</span><span class="o">.</span><span class="n">munchify</span><span class="p">({</span>
            <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
            <span class="s2">&quot;cloud&quot;</span><span class="p">:</span> <span class="n">cloud_name</span><span class="p">,</span>
            <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;batch-queue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">queue_name</span><span class="p">,</span>
            <span class="s2">&quot;cm&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;cloud&quot;</span><span class="p">:</span> <span class="n">cloud_name</span><span class="p">,</span>
                <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;batch-queue&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">queue_name</span><span class="p">,</span>
                <span class="s2">&quot;cluster&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cloudmesh&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">)[</span>
                    <span class="n">cloud_name</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s2">&quot;queue&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;policy&#39;</span><span class="p">:</span> <span class="n">policy</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;EMPTY&#39;</span><span class="p">,</span>
                <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;charge&#39;</span><span class="p">:</span> <span class="n">charge</span><span class="p">,</span>
                <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span>
                <span class="s2">&quot;numJobs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;numRunningJobs&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="c1"># Console.error(self.info)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policyFunctionMap</span> <span class="o">=</span> <span class="n">munch</span><span class="o">.</span><span class="n">munchify</span> <span class="p">(</span>
            <span class="p">{</span>
            <span class="s1">&#39;FIFO&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">popFIFO</span><span class="p">,</span>
            <span class="s1">&#39;FILO&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">popFILO</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Queue already exists&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">]</span>

<div class="viewcode-block" id="Queue.findQueue"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue.findQueue">[docs]</a>    <span class="k">def</span> <span class="nf">findQueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cloud_name</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        finds a queue in the database based on the name</span>
<span class="sd">        :param name: name of the queue</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># if self.database.exists(self.info)[0]:</span>
        <span class="c1">#     Console.error(&quot;Queue already exists&quot;)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">Name</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cloud&quot;</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">cloud</span><span class="o">=</span><span class="n">cloud_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">queue_name</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="n">cloud</span><span class="o">=</span><span class="n">cloud_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">queue_name</span><span class="p">)</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">find_by_KeyValue</span><span class="p">(</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{cloud}</span><span class="s2">-</span><span class="si">{kind}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cloud</span><span class="o">=</span><span class="n">cloud_name</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;batch-queue&#39;</span><span class="p">),</span>
            <span class="n">KeyValue</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;uid&#39;</span><span class="p">:</span><span class="n">uid</span><span class="p">})</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="ow">is</span> <span class="n">cursor</span><span class="o">.</span><span class="n">Cursor</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">munch</span><span class="o">.</span><span class="n">munchify</span><span class="p">(</span><span class="n">queue</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">True</span> <span class="c1"># # queue found</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span> <span class="c1"># queue not found</span></div>

<div class="viewcode-block" id="Queue.findClouds"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue.findClouds">[docs]</a>    <span class="k">def</span> <span class="nf">findClouds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        finds all queues in the database based on the name</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">collections</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;batch-queue&#39;</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span></div>
                <span class="c1"># all_queues = self.database.db.find()</span>
                <span class="c1"># print(all_queues)</span>

<div class="viewcode-block" id="Queue.findQueues"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue.findQueues">[docs]</a>    <span class="k">def</span> <span class="nf">findQueues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cloud_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        finds all queues in the database based on the name</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO: find all queues info from the DB based on the [&#39;cm&#39;]</span>
        <span class="n">all_queues</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">find_by_KeyValue</span><span class="p">(</span><span class="n">collection_name</span><span class="o">=</span><span class="n">cloud_name</span><span class="p">)</span>
        <span class="n">all_queues</span> <span class="o">=</span> <span class="p">[</span><span class="n">munch</span><span class="o">.</span><span class="n">munchify</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="k">for</span> <span class="n">queue</span> <span class="ow">in</span> <span class="n">all_queues</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">queue</span> <span class="ow">in</span> <span class="n">all_queues</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span></div>

<div class="viewcode-block" id="Queue.listJobs"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue.listJobs">[docs]</a>    <span class="k">def</span> <span class="nf">listJobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        list the jobs in the current queue</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Queue.removeQueue"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue.removeQueue">[docs]</a>    <span class="k">def</span> <span class="nf">removeQueue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        remove the queue from the database</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO: remove the queues info from the DB based on the [&#39;cm&#39;]</span>
        <span class="k">return</span></div>

    <span class="nd">@DatabaseUpdate</span><span class="p">()</span>   <span class="c1"># this should update the record not create a new one</span>
    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">job</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        push job to stack</span>
<span class="sd">        :param job:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">joblist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">numJobs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateStatus</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span>

    <span class="nd">@DatabaseUpdate</span><span class="p">()</span>  <span class="c1"># this should update the record not create a new one</span>
    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        pop job from stack based on the policy</span>
<span class="sd">        :param job:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">numJobs</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateStatus</span><span class="p">()</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">policy</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">policyFunctionMap</span><span class="p">[</span><span class="n">policy</span><span class="p">]()</span>


<div class="viewcode-block" id="Queue.popFIFO"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue.popFIFO">[docs]</a>    <span class="k">def</span> <span class="nf">popFIFO</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        pop job from stack based on FIFO policy</span>
<span class="sd">        :param job:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;queue&#39;</span><span class="p">][</span><span class="s1">&#39;joblist&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Queue.popFILO"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue.popFILO">[docs]</a>    <span class="k">def</span> <span class="nf">popFILO</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        pop job from stack based on FIFO policy</span>
<span class="sd">        :param job:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;queue&#39;</span><span class="p">][</span><span class="s1">&#39;joblist&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<div class="viewcode-block" id="Queue.isEmpty"><a class="viewcode-back" href="../../../../code/batch.html#cloudmesh.queue.api.Queue.Queue.isEmpty">[docs]</a>    <span class="k">def</span> <span class="nf">isEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        checks if the queue is empty</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">numJobs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="nd">@DatabaseUpdate</span><span class="p">()</span>  <span class="c1"># this should update the record not create a new one</span>
    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        activates the queue</span>

<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO: activating a queue should start submitting jobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span>

    <span class="nd">@DatabaseUpdate</span><span class="p">()</span>  <span class="c1"># this should update the record not create a new one</span>
    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        deactivates the queue</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO: stop all jobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span>

    <span class="nd">@DatabaseUpdate</span><span class="p">()</span>  <span class="c1"># this should update the record not create a new one</span>
    <span class="k">def</span> <span class="nf">updateStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        checks number of jobs and updates queue status</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">numJobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;FULL&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span>

    <span class="nd">@DatabaseUpdate</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">setParam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">param</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        set a particular parameter in the queue</span>
<span class="sd">        :param param: the parameter</span>
<span class="sd">        :param val:  value of the parameter</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settable_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Only the following parameters could be set in a &quot;</span>
                          <span class="s2">&quot;queue: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settable_params</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span></div>



    <span class="c1"># the followings are gonna be used:</span>

    <span class="c1"># @staticmethod</span>
    <span class="c1"># def _execute_in_parallel(func_args):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This is a method used for running methods in parallel</span>
    <span class="c1">#</span>
    <span class="c1">#     :param func_args:</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     target_class = func_args[0]</span>
    <span class="c1">#     method_to_call = getattr(target_class, func_args[1])</span>
    <span class="c1">#     args = list(func_args[2:])</span>
    <span class="c1">#     return method_to_call(*args)</span>
    <span class="c1">#</span>
    <span class="c1"># def _fetch_results_in_parallel(self, job_metadata, job_id, all_job_ids):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method is used to fetch the results from remote nodes.</span>
    <span class="c1">#</span>
    <span class="c1">#     :param job_metadata: the dictionary containing the information about the previously submitted job</span>
    <span class="c1">#     :param job_id: the tuple containing destination node, destination pid and destination node index when the job was submitted</span>
    <span class="c1">#     :param all_job_ids:</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     dest_node_info = self.slurm_cluster</span>
    <span class="c1">#     path = path_expand(dest_node_info[&#39;credentials&#39;][&#39;sshconfigpath&#39;])</span>
    <span class="c1">#     dest_job_id = job_id</span>
    <span class="c1">#     ssh_caller = lambda *x: self._ssh(dest_node_info[&#39;name&#39;], path, *x)</span>
    <span class="c1">#     scp_caller = lambda *x: self._scp(dest_node_info[&#39;name&#39;], path, *x)</span>
    <span class="c1">#     #</span>
    <span class="c1">#     # use the qstat from cloudmesh, we have a whole library for that</span>
    <span class="c1">#     #</span>
    <span class="c1">#     ps_output = ssh_caller(&quot;qstat -u $USER | grep %s&quot; % job_id)</span>
    <span class="c1">#     if len(ps_output) == 0 or &#39; c &#39; in ps_output.lower():</span>
    <span class="c1">#</span>
    <span class="c1">#         if not os.path.exists(job_metadata[&#39;local_path&#39;]):</span>
    <span class="c1">#             os.makedirs(job_metadata[&#39;local_path&#39;])</span>
    <span class="c1">#         # TODO: REPLACE WITH .format</span>
    <span class="c1">#         scp_caller(&#39;-r&#39;, &#39;%s:%s&#39; % (dest_node_info[&#39;name&#39;], job_metadata[&#39;remote_path&#39;]),</span>
    <span class="c1">#                    os.path.join(job_metadata[&#39;local_path&#39;], &#39;&#39;))</span>
    <span class="c1">#         os.remove(os.path.join(job_metadata[&#39;local_path&#39;],</span>
    <span class="c1">#                                os.path.basename(os.path.normpath(job_metadata[&#39;remote_path&#39;])),</span>
    <span class="c1">#                                job_metadata[&#39;script_name&#39;]))</span>
    <span class="c1">#         os.remove(os.path.join(job_metadata[&#39;local_path&#39;],</span>
    <span class="c1">#                                os.path.basename(os.path.normpath(job_metadata[&#39;remote_path&#39;])),</span>
    <span class="c1">#                                job_metadata[&#39;slurm_script_name&#39;]))</span>
    <span class="c1">#         if job_metadata[&#39;input_type&#39;] == &#39;params+file&#39;:</span>
    <span class="c1">#             os.remove(os.path.join(job_metadata[&#39;local_path&#39;],</span>
    <span class="c1">#                                    os.path.basename(os.path.normpath(job_metadata[&#39;remote_path&#39;])),</span>
    <span class="c1">#                                    job_metadata[&#39;argfile_name&#39;]))</span>
    <span class="c1">#         all_job_ids.remove(dest_job_id)</span>
    <span class="c1">#         # TODO: REPLACE WITH .format</span>
    <span class="c1">#         print(&quot;Results collected from %s for jobID %s&quot; % (dest_node_info[&#39;name&#39;], dest_job_id))</span>
    <span class="c1">#</span>
    <span class="c1"># @staticmethod</span>
    <span class="c1"># def _ssh(hostname, sshconfigpath, *args):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method is used to create remove ssh connections</span>
    <span class="c1">#</span>
    <span class="c1">#     :param hostname: hostname</span>
    <span class="c1">#     :param sshconfigpath: path to sshconfig for connecting to remote node</span>
    <span class="c1">#     :param args: the argument to be submitted via ssh</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     hide_errors_flag = False</span>
    <span class="c1">#     if type(args[-1]) == bool:</span>
    <span class="c1">#         hide_errors_flag = True</span>
    <span class="c1">#         args = args[:-1]</span>
    <span class="c1">#     #</span>
    <span class="c1">#     # should we use cloudmesh.common.Shell</span>
    <span class="c1">#     # shoudl we have a better version of that</span>
    <span class="c1">#     #</span>
    <span class="c1">#     # (stdout, stderr) = SimpleShell(...)</span>
    <span class="c1">#     #</span>
    <span class="c1">#     ssh = subprocess.Popen([&quot;ssh&quot;, hostname, &#39;-F&#39;, sshconfigpath, *args],</span>
    <span class="c1">#                            stdout=subprocess.PIPE,</span>
    <span class="c1">#                            stderr=subprocess.PIPE)</span>
    <span class="c1">#     result = ssh.stdout.readline()</span>
    <span class="c1">#     if not result:</span>
    <span class="c1">#         error = ssh.stderr.readlines()</span>
    <span class="c1">#         if len(error) &gt; 0 and hide_errors_flag == False:</span>
    <span class="c1">#             # TODO: REPLACE WITH .format</span>
    <span class="c1">#             print(&quot;ERROR in host %s: %s&quot; % (hostname, error))</span>
    <span class="c1">#         return []</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         try:</span>
    <span class="c1">#             return &#39;&#39;.join([chr(x) for x in result])</span>
    <span class="c1">#         except AttributeError:</span>
    <span class="c1">#             return [result.decode(&#39;utf-8&#39;).strip(&#39;\n&#39;)]</span>
    <span class="c1">#</span>
    <span class="c1"># @staticmethod</span>
    <span class="c1"># def _scp(hostname, sshconfigpath, *args):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method is used for scp from and to remote</span>
    <span class="c1">#</span>
    <span class="c1">#     :param hostname: hostname</span>
    <span class="c1">#     :param sshconfigpath: ssh config file</span>
    <span class="c1">#     :param args:arguments for using while copying</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     ssh = subprocess.Popen([&quot;scp&quot;, &#39;-F&#39;, sshconfigpath, *args],</span>
    <span class="c1">#                            stdout=subprocess.PIPE,</span>
    <span class="c1">#                            stderr=subprocess.PIPE)</span>
    <span class="c1">#     middle_result = ssh.stdout.readlines()</span>
    <span class="c1">#     if not middle_result:</span>
    <span class="c1">#         error = ssh.stderr.readlines()</span>
    <span class="c1">#         if len(error) &gt; 0:</span>
    <span class="c1">#</span>
    <span class="c1">#             print(&quot;ERROR in host %s: %s&quot; % (hostname, error))</span>
    <span class="c1">#</span>
    <span class="c1"># @staticmethod</span>
    <span class="c1"># def add_suffix_to_path(path, suffix):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method is used to add suffix to a path</span>
    <span class="c1">#</span>
    <span class="c1">#     :param path: path</span>
    <span class="c1">#     :param suffix: suffix</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     dir_path = os.path.dirname(path)</span>
    <span class="c1">#     full_filename = os.path.basename(path)</span>
    <span class="c1">#     filename, fileextention = os.path.splitext(full_filename)</span>
    <span class="c1">#     full_filename_new = filename + suffix + fileextention</span>
    <span class="c1">#     new_path = os.path.join(dir_path, full_filename_new)</span>
    <span class="c1">#     return new_path</span>
    <span class="c1">#</span>
    <span class="c1"># def connection_test(self, slurm_cluster_name):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method is used for testing the connection to the slurm cluster connection node</span>
    <span class="c1">#</span>
    <span class="c1">#     :param slurm_cluster_name: name of the slurm cluster which is going to be tested</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     r = self.database.find_name(&quot;job_20190327_22265228&quot;)</span>
    <span class="c1">#     print(r)</span>
    <span class="c1">#     return</span>
    <span class="c1">#     target_node_info = self.batch_config.get(&#39;slurm_cluster&#39;)[slurm_cluster_name]</span>
    <span class="c1">#     ssh_caller = lambda *x: self._ssh(target_node_info[&#39;name&#39;], os.path.expanduser(target_node_info[&#39;credentials&#39;] \</span>
    <span class="c1">#                                                                                        [&#39;sshconfigpath&#39;]), *x)</span>
    <span class="c1">#     if len(ssh_caller(&#39;uname -a&#39;)) &gt; 0:</span>
    <span class="c1">#         print(&quot;Slurm Cluster {} is accessible.&quot;.format(target_node_info[&#39;name&#39;]))</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         print(&quot;Error: Slurm Cluster {} cannot be accessed.&quot;.format(target_node_info[&#39;name&#39;]))</span>
    <span class="c1">#</span>
    <span class="c1"># def remove(self, target, key):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Used to remove virtual clusters and runtime configs</span>
    <span class="c1">#</span>
    <span class="c1">#     :param target: type of entity to be removed</span>
    <span class="c1">#     :param key: keyname of the entity to be removed</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     if target == &#39;slurm-cluster&#39;:</span>
    <span class="c1">#         self.batch_config.remove([&#39;slurm_cluster&#39;], key)</span>
    <span class="c1">#         print(&quot;Slurm-cluster {} removed successfully.&quot;.format(key))</span>
    <span class="c1">#     elif target == &#39;job&#39;:</span>
    <span class="c1">#         self.batch_config.remove([&#39;job-metadata&#39;], key)</span>
    <span class="c1">#         print(&quot;Job {} removed successfully.&quot;.format(key))</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         raise ValueError(&quot;Target to remove not found.&quot;)</span>
    <span class="c1">#</span>
    <span class="c1"># def fetch(self, job_name):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method is used to fetch results from remote nodes</span>
    <span class="c1">#</span>
    <span class="c1">#     :param job_name: the previously submitted job name</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     job_metadata = self.batch_config.get(&#39;job-metadata&#39;)[job_name]</span>
    <span class="c1">#     self.slurm_cluster = self.batch_config.get(&#39;slurm_cluster&#39;)[job_metadata[&#39;slurm_cluster_name&#39;]]</span>
    <span class="c1">#     loaded_all_job_ids = [x for x in job_metadata[&#39;jobIDs&#39;]]</span>
    <span class="c1">#     all_job_ids = Manager().list()</span>
    <span class="c1">#     all_job_ids.extend(loaded_all_job_ids)</span>
    <span class="c1">#     pool = Pool(processes=1)</span>
    <span class="c1">#     print(&quot;collecting results&quot;)</span>
    <span class="c1">#     while len(all_job_ids) &gt; 0:</span>
    <span class="c1">#         time.sleep(1)</span>
    <span class="c1">#         all_running_jobs = [(self, &#39;_fetch_results_in_parallel&#39;, job_metadata, jobID, all_job_ids) for \</span>
    <span class="c1">#                             jobID in loaded_all_job_ids if jobID in all_job_ids]</span>
    <span class="c1">#         pool.map(self._execute_in_parallel, all_running_jobs)</span>
    <span class="c1">#         print(&quot;waiting for other results if any...&quot;)</span>
    <span class="c1">#     print(&quot;All of the remote results collected.&quot;)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># def set_param(self, target, name, parameter, value):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Used to set a specific parameter in the configuration</span>
    <span class="c1">#</span>
    <span class="c1">#     :param target: the entity type on which the parameter is going to be set, e.g. runtime-config</span>
    <span class="c1">#     :param name: the entity name on which the parameter is going to be set, e.g. test-config32</span>
    <span class="c1">#     :param parameter: name of the parameter to be set</span>
    <span class="c1">#     :param value: value of that parameter to be set</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     # TODO: .format see if .format(**local) works</span>
    <span class="c1">#     if target == &#39;slurm-cluster&#39;:</span>
    <span class="c1">#         self.batch_config.deep_set([&#39;slurm_cluster&#39;, name, parameter], value)</span>
    <span class="c1">#         print(&quot;slurm-cluster parameter {} set to {} successfully.&quot;.format(parameter, value))</span>
    <span class="c1">#     elif target == &#39;job-metadata&#39;:</span>
    <span class="c1">#         self.batch_config.deep_set([&#39;job-metadata&#39;, name, parameter], value)</span>
    <span class="c1">#         print(&quot;Job-metadata parameter {} set to {} successfully.&quot;.format(parameter, value))</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         raise ValueError(&quot;Target of variable set not found.&quot;)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2019, Cloudmesh Community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>