

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cloudmesh.compute.libcloud.Provider &mdash; Cloudmesh v4 alpha documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Cloudmesh v4
          

          
          </a>

          
            
            
              <div class="version">
                4.0.28
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">PREFACE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../preface/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../preface/contributors.html">Contributors</a></li>
</ul>
<p class="caption"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/mongo.html">Cloudmesh Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docker/cmsd.html">Cloudmesh Container</a></li>
</ul>
<p class="caption"><span class="caption-text">CONCEPTS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/compute.html">Multicloud Compute Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/storage.html">Multicloud Storage Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/database.html">Multicloud Database Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/providers.html">Cloudmesh Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/openapi.html">OpenAPI Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/namespaces.html">Package Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/commandshell.html">Extensible Command Shell</a></li>
</ul>
<p class="caption"><span class="caption-text">MANUAL PAGES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../cmd5.html">Cmd5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference-card.html">Reference Card</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual/all.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-configuration.html">Manual Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-cmd5.html">Manual Cmd5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-group.html">Manual Group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-compute.html">Compute Manual Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-storage.html">Storage Manual Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-other.html">Manual Other</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../jupyter/index.html">Jupyter Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">Cloudmesh Command API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html#cloudmesh-api">Cloudmesh API</a></li>
</ul>
<p class="caption"><span class="caption-text">CONTRIBUTION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../projects/index.html">Cloudmesh Development Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/conventions.html">Code Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/manual.html">Documentation Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/manual.html#version-management">Version Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/management.html">Code Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/pytest.html">Pytest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/todo.html">ToDo</a></li>
</ul>
<p class="caption"><span class="caption-text">CLOUD ACCOUNTS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/openstack.html">OpenStack Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/aws.html">AWS Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/azure.html">Azure Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/google/account.html">Google Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/oracle/account.html">Oracle Cloud Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/box.html">Box Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/accountcreation-old.html">VM Providers (outdated)</a></li>
</ul>
<p class="caption"><span class="caption-text">OTHER</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tbd.html">OTHER</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tbd.html#outdated">OUTDATED</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Cloudmesh v4</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>cloudmesh.compute.libcloud.Provider</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cloudmesh.compute.libcloud.Provider</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">from</span> <span class="nn">cloudmesh.abstractclass.ComputeNodeABC</span> <span class="kn">import</span> <span class="n">ComputeNodeABC</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.console</span> <span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.debug</span> <span class="kn">import</span> <span class="n">VERBOSE</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.util</span> <span class="kn">import</span> <span class="n">HEADING</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.util</span> <span class="kn">import</span> <span class="n">path_expand</span>
<span class="kn">from</span> <span class="nn">cloudmesh.configuration.Config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">libcloud.compute.base</span> <span class="kn">import</span> <span class="n">NodeAuthSSHKey</span>
<span class="kn">from</span> <span class="nn">libcloud.compute.providers</span> <span class="kn">import</span> <span class="n">get_driver</span>
<span class="kn">from</span> <span class="nn">libcloud.compute.types</span> <span class="kn">import</span> <span class="n">Provider</span> <span class="k">as</span> <span class="n">LibcloudProvider</span>


<div class="viewcode-block" id="Provider"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider">[docs]</a><span class="k">class</span> <span class="nc">Provider</span><span class="p">(</span><span class="n">ComputeNodeABC</span><span class="p">):</span>
    <span class="c1"># ips</span>
    <span class="c1"># secgroups</span>
    <span class="c1"># keys</span>

    <span class="n">ProviderMapper</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;openstack&quot;</span><span class="p">:</span> <span class="n">LibcloudProvider</span><span class="o">.</span><span class="n">OPENSTACK</span><span class="p">,</span>
        <span class="s2">&quot;aws&quot;</span><span class="p">:</span> <span class="n">LibcloudProvider</span><span class="o">.</span><span class="n">EC2</span><span class="p">,</span>
        <span class="s2">&quot;google&quot;</span><span class="p">:</span> <span class="n">LibcloudProvider</span><span class="o">.</span><span class="n">GCE</span><span class="p">,</span>
        <span class="s2">&quot;azure_arm&quot;</span><span class="p">:</span> <span class="n">LibcloudProvider</span><span class="o">.</span><span class="n">AZURE_ARM</span>
    <span class="p">}</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this may be buggy as the fields could be differentbased on the provider</span>
<span class="sd">    TODO: fix output base on provider</span>
<span class="sd">    so we may need to do </span>
<span class="sd">    </span>
<span class="sd">    output = {&quot;aws&quot;: {&quot;vm&quot;: ....,,</span>
<span class="sd">                      &quot;image&quot;: ....,,</span>
<span class="sd">                      &quot;flavor&quot;: ....,,</span>
<span class="sd">              &quot;google&quot;: {&quot;vm&quot;: ....,,</span>
<span class="sd">                      &quot;image&quot;: ....,,</span>
<span class="sd">                      &quot;flavor&quot;: ....,,</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;vm&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;sort_keys&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cm.name&quot;</span><span class="p">],</span>
            <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cm.name&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;cm.cloud&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;state&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;image&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;public_ips&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;private_ips&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;cm.kind&quot;</span><span class="p">],</span>
            <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cm.name&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;cm.cloud&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;state&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;image&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;public_ips&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;private_ips&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;cm.kind&quot;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sort_keys&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cm.name&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;extra.minDisk&quot;</span><span class="p">],</span>
                  <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cm.name&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;extra.minDisk&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;updated&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;cm.driver&quot;</span><span class="p">],</span>
                  <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;MinDisk&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Updated&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Driver&quot;</span><span class="p">]},</span>
        <span class="s2">&quot;flavor&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sort_keys&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cm.name&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;vcpus&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;disk&quot;</span><span class="p">],</span>
                   <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cm.name&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;vcpus&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;ram&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;disk&quot;</span><span class="p">],</span>
                   <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;VCPUS&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;RAM&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Disk&quot;</span><span class="p">]}</span>

    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">configuration</span><span class="o">=</span><span class="s2">&quot;~/.cloudmesh/cloudmesh.yaml&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the provider. The default parameters are read from the</span>
<span class="sd">        configuration file that is defined in yaml format.</span>

<span class="sd">        :param name: The name of the provider as defined in the yaml file</span>
<span class="sd">        :param configuration: The location of the yaml configuration file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">configuration</span><span class="p">)[</span><span class="s2">&quot;cloudmesh&quot;</span><span class="p">]</span>
        <span class="c1"># self.user = conf[&quot;profile&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()[</span><span class="s2">&quot;cloudmesh&quot;</span><span class="p">][</span><span class="s2">&quot;profile&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;cloud&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">cred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;credentials&quot;</span><span class="p">]</span>
        <span class="n">deft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;kind&quot;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>

        <span class="n">VERBOSE</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="ow">in</span> <span class="n">Provider</span><span class="o">.</span><span class="n">ProviderMapper</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">get_driver</span><span class="p">(</span>
                <span class="n">Provider</span><span class="o">.</span><span class="n">ProviderMapper</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;openstack&#39;</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">cred</span><span class="p">[</span><span class="s2">&quot;OS_PASSWORD&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TBD&#39;</span><span class="p">:</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The password TBD is not allowed in cloud </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">(</span>
                    <span class="n">cred</span><span class="p">[</span><span class="s2">&quot;OS_USERNAME&quot;</span><span class="p">],</span>
                    <span class="n">cred</span><span class="p">[</span><span class="s2">&quot;OS_PASSWORD&quot;</span><span class="p">],</span>
                    <span class="n">ex_force_auth_url</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span>
                        <span class="s1">&#39;OS_AUTH_URL&#39;</span><span class="p">],</span>
                    <span class="n">ex_force_auth_version</span><span class="o">=</span><span class="s1">&#39;2.0_password&#39;</span><span class="p">,</span>
                    <span class="n">ex_tenant_name</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span>
                        <span class="s1">&#39;OS_TENANT_NAME&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;azure_arm&#39;</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">(</span>
                    <span class="n">tenant_id</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span><span class="s1">&#39;AZURE_TENANT_ID&#39;</span><span class="p">],</span>
                    <span class="n">subscription_id</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span><span class="s1">&#39;AZURE_SUBSCRIPTION_ID&#39;</span><span class="p">],</span>
                    <span class="n">key</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span><span class="s1">&#39;AZURE_APPLICATION_ID&#39;</span><span class="p">],</span>
                    <span class="n">secret</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span><span class="s1">&#39;AZURE_SECRET_KEY&#39;</span><span class="p">],</span>
                    <span class="n">region</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span><span class="s1">&#39;AZURE_REGION&#39;</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;awslibcloud&#39;</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">(</span>
                    <span class="n">cred</span><span class="p">[</span><span class="s2">&quot;EC2_ACCESS_ID&quot;</span><span class="p">],</span>
                    <span class="n">cred</span><span class="p">[</span><span class="s2">&quot;EC2_SECRET_KEY&quot;</span><span class="p">],</span>
                    <span class="n">region</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span><span class="s2">&quot;EC2_REGION&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;googlelibcloud&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">(</span>
                    <span class="n">cred</span><span class="p">[</span><span class="s2">&quot;client_email&quot;</span><span class="p">],</span>
                    <span class="n">cred</span><span class="p">[</span><span class="s2">&quot;path_to_json_file&quot;</span><span class="p">],</span>  <span class="c1"># should be placed in .cloudmesh</span>
                    <span class="n">project</span><span class="o">=</span><span class="n">cred</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Specified provider not available&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># self.default_image = deft[&quot;image&quot;]</span>
        <span class="c1"># self.default_size = deft[&quot;size&quot;]</span>
        <span class="c1"># self.default.location = cred[&quot;datacenter&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">public_key_path</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;profile&quot;</span><span class="p">][</span><span class="s2">&quot;publickey&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_path</span> <span class="o">=</span> <span class="n">path_expand</span><span class="p">(</span>
            <span class="n">Config</span><span class="p">()[</span><span class="s2">&quot;cloudmesh&quot;</span><span class="p">][</span><span class="s2">&quot;profile&quot;</span><span class="p">][</span><span class="s2">&quot;publickey&quot;</span><span class="p">])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_val</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<div class="viewcode-block" id="Provider.update_dict"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.update_dict">[docs]</a>    <span class="k">def</span> <span class="nf">update_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Libcloud returns an object or list of objects With the dict method</span>
<span class="sd">        this object is converted to a dict. Typically this method is used</span>
<span class="sd">        internally.</span>

<span class="sd">        :param elements: the elements</span>
<span class="sd">        :param kind: Kind is image, flavor, or node</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">_elements</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">elements</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">_elements</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="vm">__dict__</span>
            <span class="k">del</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;extra&quot;</span><span class="p">]</span>  <span class="c1"># Remove extra from google node</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="n">kind</span><span class="p">,</span>
                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span><span class="p">,</span>
                <span class="s2">&quot;cloud&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloud</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="s2">&quot;created_at&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;created&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;created_at&quot;</span><span class="p">])</span>
                    <span class="c1"># del entry[&quot;created_at&quot;]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;created&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;modified&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;flavor&#39;</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;created&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;cm&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
                <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;cm&#39;</span><span class="p">][</span><span class="s1">&#39;updated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;secgroup&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;openstack&#39;</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;openstack&#39;</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">if</span> <span class="s2">&quot;_uuid&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;_uuid&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;driver&quot;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span>

            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="Provider.find"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        finds an element in elements with the specified name</span>
<span class="sd">        :param elements: The elements</span>
<span class="sd">        :param name: The name to be found</span>
<span class="sd">        :param: If raw is True, elements is a libcloud object.</span>
<span class="sd">                Otherwise elements is a dict</span>
<span class="sd">        :param raw: if raw is used the return from the driver is used and not</span>
<span class="sd">                    a cleaned dict, not implemented</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="c1"># pprint (element)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">raw</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">element</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">element</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.keys"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists the keys on the cloud</span>
<span class="sd">        :param raw: If raw is set to True the lib cloud object is returned</span>
<span class="sd">                    otherwise a dict is returened.</span>
<span class="sd">        :return: dict or libcloud object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">list_key_pairs</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">entries</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.key_upload"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.key_upload">[docs]</a>    <span class="k">def</span> <span class="nf">key_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        uploads the key specified in the yaml configuration to the cloud</span>
<span class="sd">        :param key:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#</span>
        <span class="c1"># TODO: if you have a key in the local machine that is different from an</span>
        <span class="c1"># already uploaded ky this function will fail. The key in the cloud</span>
        <span class="c1"># needs to be removed first</span>
        <span class="c1">#</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cloudkey</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">pprint</span><span class="p">(</span><span class="n">cloudkey</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cloudkey</span><span class="p">[</span><span class="s1">&#39;fingerprint&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">]:</span>
                <span class="k">return</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">import_key_pair_from_file</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{user}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.list_secgroups"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.list_secgroups">[docs]</a>    <span class="k">def</span> <span class="nf">list_secgroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="n">secgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_list_security_groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
                <span class="n">secgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">(</span><span class="n">secgroups</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;secgroup&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">secgroups</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.list_secgroup_rules"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.list_secgroup_rules">[docs]</a>    <span class="k">def</span> <span class="nf">list_secgroup_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secgroup</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="n">secgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_secgroups</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">)</span>
            <span class="n">thegroup</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                <span class="c1"># Theoretically it&#39;s possible to have secgroups with the same</span>
                <span class="c1"># name,</span>
                <span class="c1"># in this case, we list rules for the first one only.</span>
                <span class="c1"># In reality this don&#39;t seem like a good practice so we assume</span>
                <span class="c1"># this situation MOST LIKELY does not occur.</span>
                <span class="k">for</span> <span class="n">_secgroup</span> <span class="ow">in</span> <span class="n">secgroups</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_secgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">secgroup</span><span class="p">:</span>
                        <span class="n">thegroup</span> <span class="o">=</span> <span class="n">_secgroup</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># this already returns only one entry</span>
                <span class="n">thegroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">secgroups</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">secgroup</span><span class="p">)</span>

            <span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                <span class="c1"># dealing with object</span>
                <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">thegroup</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
                    <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># dealing with dict</span>
                <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">thegroup</span><span class="p">[</span><span class="s2">&quot;rules&quot;</span><span class="p">]:</span>
                    <span class="c1"># self.p.dict() converted the object into a list of dict,</span>
                    <span class="c1"># even if there is only one object</span>
                    <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">(</span><span class="n">rule</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rules</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.add_secgroup"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.add_secgroup">[docs]</a>    <span class="k">def</span> <span class="nf">add_secgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secgroupname</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_create_security_group</span><span class="p">(</span>
                <span class="n">secgroupname</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.remove_secgroup"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.remove_secgroup">[docs]</a>    <span class="k">def</span> <span class="nf">remove_secgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secgroupname</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="n">secgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_secgroups</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">thegroups</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">secgroup</span> <span class="ow">in</span> <span class="n">secgroups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">secgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">secgroupname</span><span class="p">:</span>
                    <span class="n">thegroups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">secgroup</span><span class="p">)</span>
            <span class="c1"># pprint (secgroups)</span>
            <span class="c1"># pprint (thegroups)</span>
            <span class="k">if</span> <span class="n">thegroups</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">thegroup</span> <span class="ow">in</span> <span class="n">thegroups</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_delete_security_group</span><span class="p">(</span><span class="n">thegroup</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Provider.add_rules_to_secgroup"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.add_rules_to_secgroup">[docs]</a>    <span class="k">def</span> <span class="nf">add_rules_to_secgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secgroupname</span><span class="p">,</span> <span class="n">newrules</span><span class="p">):</span>
        <span class="n">oldrules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_secgroup_rules</span><span class="p">(</span><span class="n">secgroupname</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">oldrules</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">newrules</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="n">secgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_secgroups</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">secgroup</span> <span class="ow">in</span> <span class="n">secgroups</span><span class="p">:</span>
                <span class="c1"># for multiple secgroups with the same name,</span>
                <span class="c1"># add the rules to all the groups</span>
                <span class="k">if</span> <span class="n">secgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">secgroupname</span><span class="p">:</span>
                    <span class="c1"># supporting multiple rules at once</span>
                    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">newrules</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_create_security_group_rule</span><span class="p">(</span>
                            <span class="n">secgroup</span><span class="p">,</span>
                            <span class="n">rule</span><span class="p">[</span><span class="s2">&quot;ip_protocol&quot;</span><span class="p">],</span>
                            <span class="n">rule</span><span class="p">[</span><span class="s2">&quot;from_port&quot;</span><span class="p">],</span>
                            <span class="n">rule</span><span class="p">[</span><span class="s2">&quot;to_port&quot;</span><span class="p">],</span>
                            <span class="n">cidr</span><span class="o">=</span><span class="n">rule</span><span class="p">[</span><span class="s2">&quot;ip_range&quot;</span><span class="p">]</span>
                        <span class="p">)</span></div>

<div class="viewcode-block" id="Provider.remove_rules_from_secgroup"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.remove_rules_from_secgroup">[docs]</a>    <span class="k">def</span> <span class="nf">remove_rules_from_secgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secgroupname</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
        <span class="n">oldrules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_secgroup_rules</span><span class="p">(</span><span class="n">secgroupname</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">oldrules</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="n">secgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_secgroups</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">secgroup</span> <span class="ow">in</span> <span class="n">secgroups</span><span class="p">:</span>
                <span class="c1"># for multiple secgroups with the same name,</span>
                <span class="c1"># remove the rules from all the groups</span>
                <span class="k">if</span> <span class="n">secgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">secgroupname</span><span class="p">:</span>
                    <span class="c1"># supporting multiple rules at once</span>
                    <span class="c1"># get all rules, in obj format</span>
                    <span class="n">rulesobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_secgroup_rules</span><span class="p">(</span><span class="n">secgroup</span><span class="o">=</span><span class="n">secgroupname</span><span class="p">,</span>
                                                        <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ruleobj</span> <span class="ow">in</span> <span class="n">rulesobj</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">ruleobj</span><span class="o">.</span><span class="n">ip_protocol</span> <span class="o">==</span> <span class="n">rule</span><span class="p">[</span><span class="s2">&quot;ip_protocol&quot;</span><span class="p">]</span> <span class="ow">and</span>
                                <span class="n">ruleobj</span><span class="o">.</span><span class="n">from_port</span> <span class="o">==</span> <span class="n">rule</span><span class="p">[</span><span class="s2">&quot;from_port&quot;</span><span class="p">]</span> <span class="ow">and</span>
                                <span class="n">ruleobj</span><span class="o">.</span><span class="n">to_port</span> <span class="o">==</span> <span class="n">rule</span><span class="p">[</span><span class="s2">&quot;to_port&quot;</span><span class="p">]</span> <span class="ow">and</span>
                                <span class="n">ruleobj</span><span class="o">.</span><span class="n">ip_range</span> <span class="o">==</span> <span class="n">rule</span><span class="p">[</span><span class="s2">&quot;ip_range&quot;</span><span class="p">]):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_delete_security_group_rule</span><span class="p">(</span>
                                    <span class="n">ruleobj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.images"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.images">[docs]</a>    <span class="k">def</span> <span class="nf">images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists the images on the cloud</span>
<span class="sd">        :param raw: If raw is set to True the lib cloud object is returned</span>
<span class="sd">                    otherwise a dict is returened.</span>
<span class="sd">        :return: dict or libcloud object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;openstack&quot;</span><span class="p">,</span> <span class="s2">&quot;aws&quot;</span><span class="p">,</span> <span class="s2">&quot;google&quot;</span><span class="p">]:</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">list_images</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">entries</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s2">&quot;azure_arm&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;publisher&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> \
                    <span class="s2">&quot;offer&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> \
                    <span class="s2">&quot;sku&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">list_images</span><span class="p">(</span>
                        <span class="n">ex_publisher</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;publisher&quot;</span><span class="p">],</span>
                        <span class="n">ex_offer</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;offer&quot;</span><span class="p">],</span>
                        <span class="n">ex_sku</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;sku&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">entries</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
                <span class="c1"># azure image query without given more parameters cost</span>
                <span class="c1"># too long to return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.image"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.image">[docs]</a>    <span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the image with a given nmae</span>
<span class="sd">        :param name: The name of the image</span>
<span class="sd">        :return: the dict of the image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.flavors"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.flavors">[docs]</a>    <span class="k">def</span> <span class="nf">flavors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists the flavors on the cloud</span>
<span class="sd">        :param raw: If raw is set to True the lib cloud object is returned</span>
<span class="sd">                    otherwise a dict is returened.</span>
<span class="sd">        :return: dict or libcloud object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">list_sizes</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">entries</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;flavor&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.flavor"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.flavor">[docs]</a>    <span class="k">def</span> <span class="nf">flavor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the flavor with a given name</span>
<span class="sd">        :param name: The name of the flavor</span>
<span class="sd">        :return: The dict of the flavor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flavors</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.apply"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        apply a function to a given list of nodes</span>

<span class="sd">        :param fname: Name of the function to be applied to the given nodes</span>
<span class="sd">        :param names: A list of node names</span>
<span class="sd">        :return:  A list of dict representing the nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="c1"># names = Parameter.expand(names)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="n">fname</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.start"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a list of nodes with the given names</span>

<span class="sd">        :param names: A list of node names</span>
<span class="sd">        :return:  A list of dict representing the nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VERBOSE</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_start_node</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.stop"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop a list of nodes with the given names</span>

<span class="sd">        :param names: A list of node names</span>
<span class="sd">        :return:  A list of dict representing the nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_stop_node</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.info"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the information of a node with a given name</span>

<span class="sd">        :param name: The name of teh virtual machine</span>
<span class="sd">        :return: The dict representing the node including updated status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.suspend"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.suspend">[docs]</a>    <span class="k">def</span> <span class="nf">suspend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOT YET IMPLEMENTED.</span>

<span class="sd">        suspends the node with the given name.</span>

<span class="sd">        :param name: the name of the node</span>
<span class="sd">        :return: The dict representing the node</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="kc">None</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        raise NotImplementedError</span>

<span class="sd">        #</span>
<span class="sd">        # BUG THIS CODE DOES NOT WORK</span>
<span class="sd">        #</span>
<span class="sd">        nodes = self.list(raw=True)</span>
<span class="sd">        for node in nodes:</span>
<span class="sd">            if node.name == name:</span>
<span class="sd">                r = self.cloudman.ex_stop_node(self._get_node(node.name),</span>
<span class="sd">                                               deallocate=False)</span>
<span class="sd">                # print(r)</span>
<span class="sd">                # BUG THIS IS NOT A DICT</span>
<span class="sd">                return(node, name=name)</span>
<span class="sd">                self.cloudman.destroy_node(node)</span>

<span class="sd">        #</span>
<span class="sd">        # should return the updated names dict, e.g. status and so on</span>
<span class="sd">        # the above specification is for one name</span>
<span class="sd">        #</span>
<span class="sd">        </span>
<span class="sd">        return None</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Provider.resume"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.resume">[docs]</a>    <span class="k">def</span> <span class="nf">resume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        resume a stopped node.</span>

<span class="sd">        :param name: the name of the node</span>
<span class="sd">        :return: the dict of the node</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the following does not return the dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_start_node</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.list"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists the vms on the cloud</span>
<span class="sd">        :param raw: If raw is set to True the lib cloud object is returned</span>
<span class="sd">                    otherwise a dict is returened.</span>
<span class="sd">        :return: dict or libcloud object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s2">&quot;azure_asm&quot;</span><span class="p">:</span>
                <span class="c1">#</span>
                <span class="c1"># BUG: ex_cloud_service_name needs to be defined, explore the</span>
                <span class="c1"># azure documentation n how to find it</span>
                <span class="c1">#</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s2">&quot;azure_arm&quot;</span><span class="p">:</span>
                <span class="c1">#</span>
                <span class="c1"># BUG: figure out how to use that</span>
                <span class="c1">#</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">entries</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;node&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.destroy"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destroys the node</span>
<span class="sd">        :param names: the name of the node</span>
<span class="sd">        :return: the dict of the node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># names = Parameter.expand(names)</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="c1"># bug status should change to destroyed</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.reboot"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.reboot">[docs]</a>    <span class="k">def</span> <span class="nf">reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reboot a list of nodes with the given names</span>

<span class="sd">        :param names: A list of node names</span>
<span class="sd">        :return:  A list of dict representing the nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">reboot_node</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.create"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">timeout</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates a named node</span>

<span class="sd">        :param name: the name of the node</span>
<span class="sd">        :param image: the image used</span>
<span class="sd">        :param size: the size of the image</span>
<span class="sd">        :param location: the location of the image</span>
<span class="sd">        :param timeout: a timeout in seconds that is invoked in case the image</span>
<span class="sd">                        does not boot. The default is set to 3 minutes.</span>
<span class="sd">        :param kwargs: additional arguments HEADING(c=&quot;.&quot;)ed along at time of</span>
<span class="sd">                       boot</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_use</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">flavor_use</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># keyname = Config()[&quot;cloudmesh&quot;][&quot;profile&quot;][&quot;user&quot;]</span>
        <span class="c1"># ex_keyname has to be the registered keypair name in cloud</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;openstack&quot;</span><span class="p">,</span> <span class="s2">&quot;aws&quot;</span><span class="p">,</span> <span class="s2">&quot;google&quot;</span><span class="p">]:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_image</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">image</span><span class="p">:</span>
                    <span class="n">image_use</span> <span class="o">=</span> <span class="n">_image</span>
                    <span class="k">break</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;azure_arm&#39;</span><span class="p">:</span>
            <span class="n">image_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="n">flavors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavors</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_flavor</span> <span class="ow">in</span> <span class="n">flavors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_flavor</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>
                <span class="n">flavor_use</span> <span class="o">=</span> <span class="n">_flavor</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s2">&quot;openstack&quot;</span><span class="p">:</span>

            <span class="k">if</span> <span class="s2">&quot;ex_security_groups&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">secgroupsobj</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1">#</span>
                <span class="c1"># this gives existing secgroups in obj form</span>
                <span class="n">secgroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_secgroups</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">secgroup</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ex_security_groups&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">_secgroup</span> <span class="ow">in</span> <span class="n">secgroups</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">_secgroup</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">secgroup</span><span class="p">:</span>
                            <span class="n">secgroupsobj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_secgroup</span><span class="p">)</span>
                <span class="c1"># now secgroup name is converted to object which</span>
                <span class="c1"># is required by the libcloud api call</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ex_security_groups&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">secgroupsobj</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;openstack&quot;</span><span class="p">,</span> <span class="s2">&quot;aws&quot;</span><span class="p">]:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image_use</span><span class="p">,</span>
                                             <span class="n">size</span><span class="o">=</span><span class="n">flavor_use</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;azure_arm&#39;</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;sshpubkey&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">auth</span> <span class="o">=</span> <span class="n">NodeAuthSSHKey</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;sshpubkey&quot;</span><span class="p">])</span>
            <span class="n">pubip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_create_public_ip</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{nodename}</span><span class="s1">-ip&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">nodename</span><span class="o">=</span><span class="n">name</span><span class="p">),</span>
                <span class="n">resource_group</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;resource_group&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">networks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_list_networks</span><span class="p">()</span>
            <span class="n">network_use</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">networks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">network</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]:</span>
                    <span class="n">network_use</span> <span class="o">=</span> <span class="n">network</span>
                    <span class="n">pprint</span><span class="p">(</span><span class="n">network_use</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="n">subnets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_list_subnets</span><span class="p">(</span><span class="n">network_use</span><span class="p">)</span>
            <span class="n">subnet_use</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">subnet</span> <span class="ow">in</span> <span class="n">subnets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">subnet</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;subnet&quot;</span><span class="p">]:</span>
                    <span class="n">subnet_use</span> <span class="o">=</span> <span class="n">subnet</span>
                    <span class="k">break</span>
            <span class="n">nic_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_create_network_interface</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{nodename}</span><span class="s1">-nic&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">nodename</span><span class="o">=</span><span class="n">name</span><span class="p">),</span>
                <span class="n">subnet</span><span class="o">=</span><span class="n">subnet_use</span><span class="p">,</span>
                <span class="n">resource_group</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;resource_group&quot;</span><span class="p">],</span>
                <span class="n">public_ip</span><span class="o">=</span><span class="n">pubip</span>
            <span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">image</span><span class="o">=</span><span class="n">image_use</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">flavor_use</span><span class="p">,</span>
                <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
                <span class="c1"># the following three were created in azure portal</span>
                <span class="n">ex_resource_group</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;resource_group&quot;</span><span class="p">],</span>
                <span class="c1"># for storage account, use the default v2 setting</span>
                <span class="n">ex_storage_account</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;storage_account&quot;</span><span class="p">],</span>
                <span class="c1"># under the storage account, blobs services,</span>
                <span class="c1"># create &#39;vhds&#39; container</span>
                <span class="n">ex_blob_container</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;blob_container&quot;</span><span class="p">],</span>
                <span class="n">ex_nic</span><span class="o">=</span><span class="n">nic_use</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s1">&#39;google&#39;</span><span class="p">:</span>
            <span class="n">location_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;credentials&quot;</span><span class="p">][</span><span class="s2">&quot;datacenter&quot;</span><span class="p">]</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_val</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;ssh-keys&quot;</span><span class="p">}]}</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image_use</span><span class="p">,</span>
                                             <span class="n">size</span><span class="o">=</span><span class="n">flavor_use</span><span class="p">,</span>
                                             <span class="n">location</span><span class="o">=</span><span class="n">location_use</span><span class="p">,</span>
                                             <span class="n">ex_metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;this cloud is not yet supported&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_dict</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;node&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Provider.get_public_ip"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.get_public_ip">[docs]</a>    <span class="k">def</span> <span class="nf">get_public_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># pools = self.cloudman.ex_list_floating_ip_pools()</span>
        <span class="c1"># ex_get_floating_ip(ip)</span>
        <span class="c1"># ex_create_floating_ip(ip_pool=pools[0])</span>
        <span class="c1">#</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    ex_attach_floating_ip_to_node(node, ip)</span>
<span class="sd">                    ex_detach_floating_ip_from_node(node, ip)</span>
<span class="sd">                    ex_delete_floating_ip(ip)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudtype</span> <span class="o">==</span> <span class="s2">&quot;openstack&quot;</span><span class="p">:</span>
            <span class="n">ips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_list_floating_ips</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ips</span><span class="p">:</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="n">ips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_list_floating_ip_pools</span><span class="p">()</span>
                <span class="c1"># pprint (pools)</span>
                <span class="c1"># ex_get_floating_ip(ip)</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_create_floating_ip</span><span class="p">(</span><span class="n">ip_pool</span><span class="o">=</span><span class="n">pools</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ip</span></div>

<div class="viewcode-block" id="Provider.attach_public_ip"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.attach_public_ip">[docs]</a>    <span class="k">def</span> <span class="nf">attach_public_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_attach_floating_ip_to_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.detach_public_ip"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.detach_public_ip">[docs]</a>    <span class="k">def</span> <span class="nf">detach_public_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_detach_floating_ip_from_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudman</span><span class="o">.</span><span class="n">ex_delete_floating_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span></div>

<div class="viewcode-block" id="Provider.rename"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.rename">[docs]</a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rename a node. NOT YET IMPLEMENTED.</span>

<span class="sd">        :param destination:</span>
<span class="sd">        :param name: the current name</span>
<span class="sd">        :return: the dict with the new name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if destination is None, increase the name counter and use the new name</span>
        <span class="n">HEADING</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Provider.ssh"><a class="viewcode-back" href="../../../../api/cloudmesh.compute.libcloud.html#cloudmesh.compute.libcloud.Provider.Provider.ssh">[docs]</a>    <span class="k">def</span> <span class="nf">ssh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pub&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testnode</span> <span class="o">=</span> <span class="n">node</span>
                <span class="k">break</span>
        <span class="n">pubip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testnode</span><span class="o">.</span><span class="n">public_ips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">pubip</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ssh&#39;</span><span class="p">,</span>
               <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="s2">&quot;StrictHostKeyChecking=no&quot;</span><span class="p">,</span>
               <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="s2">&quot;UserKnownHostsFile=/dev/null&quot;</span><span class="p">,</span>
               <span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">command</span><span class="p">]</span>
        <span class="n">VERBOSE</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>

        <span class="n">ssh</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span>
                               <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                               <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RESULT:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    THIS CODE IS BUUGY AS IT OVERWRITES ALL PROVIDERS, THE CODE ABOVE SEEMS TO </span>
<span class="sd">    WORK</span>
<span class="sd">    def ssh(self, name, ips, username=None, key=None, quiet=None, command=None, </span>
<span class="sd">            script=None, modify_knownhosts=None):</span>
<span class="sd">        if key == None:</span>
<span class="sd">            key = self.spec[&#39;credentials&#39;][&#39;EC2_PRIVATE_KEY_FILE_PATH&#39;] + </span>
<span class="sd">             self.spec[&#39;credentials&#39;][&#39;EC2_PRIVATE_KEY_FILE_NAME&#39;]</span>
<span class="sd">        for ip in ips:</span>
<span class="sd">            location = username + &#39;@&#39; + ip</span>
<span class="sd">            if command != None:</span>
<span class="sd">                ssh_command = [&#39;ssh&#39;, &#39;-i&#39;, key, location, command]</span>
<span class="sd">                subprocess.run(ssh_command)</span>
<span class="sd">            elif script != None:</span>
<span class="sd">                BUG, doesn&#39;t work#</span>
<span class="sd">                ssh_command = [&#39;ssh&#39;, &#39;-i&#39;, key, location, </span>
<span class="sd">                               &#39;bash&#39;, &#39;-s&#39;, &#39;&lt;&#39;, script]</span>
<span class="sd">                subprocess.call(ssh_command, shell=True)</span>
<span class="sd">    &quot;&quot;&quot;</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2019, Cloudmesh Community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>