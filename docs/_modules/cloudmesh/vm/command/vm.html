

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cloudmesh.vm.command.vm &mdash; Cloudmesh v4 alpha documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Cloudmesh v4
          

          
          </a>

          
            
            
              <div class="version">
                4.0.28
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">PREFACE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../preface/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../preface/contributors.html">Contributors</a></li>
</ul>
<p class="caption"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/mongo.html">Cloudmesh Database</a></li>
</ul>
<p class="caption"><span class="caption-text">MANUAL PAGES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../cmd5.html">Cmd5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference-card.html">Reference Card</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual/commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-cmd5.html">Manual Cmd5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-group.html">Manual Group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-compute.html">Compute Manual Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-storage.html">Storage Manual Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual-other.html">Manual Other</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../jupyter/index.html">Jupyter Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">Cloudmesh Command API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html#cloudmesh-api">Cloudmesh API</a></li>
</ul>
<p class="caption"><span class="caption-text">CONTRIBUTION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../projects/index.html">Cloudmesh Development Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/conventions.html">Code Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/manual.html">Documentation Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/manual.html#version-management">Version Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/management.html">Code Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/pytest.html">Pytest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev/todo.html">ToDo</a></li>
</ul>
<p class="caption"><span class="caption-text">CLOUD ACCOUNTS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/aws.html">AWS Account Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/azure.html">Azure Account Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/google.html">Google Storage Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/box.html">Box Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounts/accountcreation-old.html">VM Providers (outdated)</a></li>
</ul>
<p class="caption"><span class="caption-text">OTHER</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tbd.html">OTHER</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tbd.html#outdated">OUTDATED</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Cloudmesh v4</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>cloudmesh.vm.command.vm</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cloudmesh.vm.command.vm</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>

<span class="kn">from</span> <span class="nn">cloudmesh.common.debug</span> <span class="k">import</span> <span class="n">VERBOSE</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.Printer</span> <span class="k">import</span> <span class="n">Printer</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.console</span> <span class="k">import</span> <span class="n">Console</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.error</span> <span class="k">import</span> <span class="n">Error</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.parameter</span> <span class="k">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common3.host</span> <span class="k">import</span> <span class="n">Host</span>
<span class="kn">from</span> <span class="nn">cloudmesh.compute.vm.Provider</span> <span class="k">import</span> <span class="n">Provider</span>
<span class="kn">from</span> <span class="nn">cloudmesh.management.configuration.arguments</span> <span class="k">import</span> <span class="n">Arguments</span>
<span class="kn">from</span> <span class="nn">cloudmesh.mongo.CmDatabase</span> <span class="k">import</span> <span class="n">CmDatabase</span>
<span class="kn">from</span> <span class="nn">cloudmesh.shell.command</span> <span class="k">import</span> <span class="n">PluginCommand</span>
<span class="kn">from</span> <span class="nn">cloudmesh.shell.command</span> <span class="k">import</span> <span class="n">command</span><span class="p">,</span> <span class="n">map_parameters</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.variables</span> <span class="k">import</span> <span class="n">Variables</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.Shell</span> <span class="k">import</span> <span class="n">Shell</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.parameter</span> <span class="k">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.dotdict</span> <span class="k">import</span> <span class="n">dotdict</span>
<span class="kn">from</span> <span class="nn">cloudmesh.configuration.Config</span> <span class="k">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">cloudmesh.management.configuration.name</span> <span class="k">import</span> <span class="n">Name</span>
<span class="kn">from</span> <span class="nn">cloudmesh.common.util</span> <span class="k">import</span> <span class="n">banner</span>
<span class="kn">from</span> <span class="nn">cloudmesh.image.Image</span> <span class="k">import</span> <span class="n">Image</span>

<div class="viewcode-block" id="VmCommand"><a class="viewcode-back" href="../../../../api/cloudmesh.vm.command.html#cloudmesh.vm.command.vm.VmCommand">[docs]</a><span class="k">class</span> <span class="nc">VmCommand</span><span class="p">(</span><span class="n">PluginCommand</span><span class="p">):</span>

    <span class="c1"># see also https://github.com/cloudmesh/client/edit/master/cloudmesh_client/shell/plugins/VmCommand.py</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="nd">@command</span>
    <span class="k">def</span> <span class="nf">do_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ::</span>

<span class="sd">            Usage:</span>
<span class="sd">                vm ping [NAMES] [--cloud=CLOUDS] [--count=N]</span>
<span class="sd">                vm check [NAMES] [--cloud=CLOUDS] [--username=USERNAME]</span>
<span class="sd">                vm status [NAMES] [--cloud=CLOUDS] [--output=OUTPUT]</span>
<span class="sd">                vm console [NAME] [--force]</span>
<span class="sd">                vm stop [NAMES]  [--dryrun]</span>
<span class="sd">                vm start [NAMES] [--dryrun]</span>
<span class="sd">                vm terminate [NAMES] [--cloud=CLOUD] [--dryrun]</span>
<span class="sd">                vm delete [NAMES] [--cloud=CLOUD] [--dryrun]</span>
<span class="sd">                vm refresh [--cloud=CLOUDS]</span>
<span class="sd">                vm list [NAMES]</span>
<span class="sd">                        [--cloud=CLOUDS]</span>
<span class="sd">                        [--output=OUTPUT]</span>
<span class="sd">                        [--refresh]</span>
<span class="sd">                vm boot [--n=COUNT]</span>
<span class="sd">                        [--name=VMNAMES]</span>
<span class="sd">                        [--cloud=CLOUD]</span>
<span class="sd">                        [--username=USERNAME]</span>
<span class="sd">                        [--image=IMAGE]</span>
<span class="sd">                        [--flavor=FLAVOR]</span>
<span class="sd">                        [--public]</span>
<span class="sd">                        [--secgroup=SECGROUPs]</span>
<span class="sd">                        [--group=GROUPs]</span>
<span class="sd">                        [--key=KEY]</span>
<span class="sd">                        [--dryrun]</span>
<span class="sd">                        [-v]</span>
<span class="sd">                vm meta list [NAME]</span>
<span class="sd">                vm meta set [NAME] KEY=VALUE...</span>
<span class="sd">                vm meta delete [NAME] KEY...</span>
<span class="sd">                vm script [--name=NAMES]</span>
<span class="sd">                          [--username=USERNAME]</span>
<span class="sd">                          [--key=KEY]</span>
<span class="sd">                          [--dryrun]</span>
<span class="sd">                          [--dir=DESTINATION]</span>
<span class="sd">                          SCRIPT</span>
<span class="sd">                vm ip assign [NAMES]</span>
<span class="sd">                          [--cloud=CLOUD]</span>
<span class="sd">                vm ip show [NAMES]</span>
<span class="sd">                           [--group=GROUP]</span>
<span class="sd">                           [--cloud=CLOUD]</span>
<span class="sd">                           [--output=OUTPUT]</span>
<span class="sd">                           [--refresh]</span>
<span class="sd">                vm ip inventory [NAMES]</span>
<span class="sd">                vm ssh [NAMES]</span>
<span class="sd">                       [--username=USER]</span>
<span class="sd">                       [--quiet]</span>
<span class="sd">                       [--ip=IP]</span>
<span class="sd">                       [--key=KEY]</span>
<span class="sd">                       [--command=COMMAND]</span>
<span class="sd">                vm put SOURCE DESTINATION [NAMES]</span>
<span class="sd">                vm get SOURCE DESTINATION [NAMES]</span>
<span class="sd">                vm rename [OLDNAMES] [NEWNAMES] [--force] [--dryrun]</span>
<span class="sd">                vm wait [--cloud=CLOUD] [--interval=SECONDS]</span>
<span class="sd">                vm info [--cloud=CLOUD]</span>
<span class="sd">                        [--output=OUTPUT]</span>
<span class="sd">                vm username USERNAME [NAMES] [--cloud=CLOUD]</span>
<span class="sd">                vm resize [NAMES] [--size=SIZE]</span>

<span class="sd">            Arguments:</span>
<span class="sd">                OUTPUT         the output format</span>
<span class="sd">                COMMAND        positional arguments, the commands you want to</span>
<span class="sd">                               execute on the server(e.g. ls -a) separated by &#39;;&#39;,</span>
<span class="sd">                               you will get a return of executing result instead of login to</span>
<span class="sd">                               the server, note that type in -- is suggested before</span>
<span class="sd">                               you input the commands</span>
<span class="sd">                NAME           server name. By default it is set to the name of last vm from database.</span>
<span class="sd">                NAMES          server name. By default it is set to the name of last vm from database.</span>
<span class="sd">                KEYPAIR_NAME   Name of the vm keypair to be used to create VM. Note this is</span>
<span class="sd">                               not a path to key.</span>
<span class="sd">                NEWNAMES       New names of the VM while renaming.</span>
<span class="sd">                OLDNAMES       Old names of the VM while renaming.</span>

<span class="sd">            Options:</span>
<span class="sd">                -v             verbose, prints the dict at the end</span>
<span class="sd">                --output=OUTPUT   the output format</span>
<span class="sd">                -H --modify-knownhosts  Do not modify ~/.ssh/known_hosts file</span>
<span class="sd">                                      when ssh&#39;ing into a machine</span>
<span class="sd">                --username=USERNAME   the username to login into the vm. If not</span>
<span class="sd">                                      specified it will be guessed</span>
<span class="sd">                                      from the image name and the cloud</span>
<span class="sd">                --ip=IP          give the public ip of the server</span>
<span class="sd">                --cloud=CLOUD    give a cloud to work on, if not given, selected</span>
<span class="sd">                                 or default cloud will be used</span>
<span class="sd">                --count=COUNT    give the number of servers to start</span>
<span class="sd">                --detail         for table, a brief version</span>
<span class="sd">                                 is used as default, use this flag to print</span>
<span class="sd">                                 detailed table</span>
<span class="sd">                --flavor=FLAVOR  give the name or id of the flavor</span>
<span class="sd">                --group=GROUP          give the group name of server</span>
<span class="sd">                --secgroup=SECGROUP    security group name for the server</span>
<span class="sd">                --image=IMAGE    give the name or id of the image</span>
<span class="sd">                --key=KEY        specify a key to use, input a string which</span>
<span class="sd">                                 is the full path to the private key file</span>
<span class="sd">                --keypair_name=KEYPAIR_NAME   Name of the vm keypair to</span>
<span class="sd">                                              be used to create VM.</span>
<span class="sd">                                              Note this is not a path to key.</span>
<span class="sd">                --user=USER      give the user name of the server that you want</span>
<span class="sd">                                 to use to login</span>
<span class="sd">                --name=NAME      give the name of the virtual machine</span>
<span class="sd">                --force          rename/ delete vms without user&#39;s confirmation</span>
<span class="sd">                --command=COMMAND</span>
<span class="sd">                                 specify the commands to be executed</span>


<span class="sd">            Description:</span>
<span class="sd">                commands used to boot, start or delete servers of a cloud</span>

<span class="sd">                vm default [options...]</span>
<span class="sd">                    Displays default parameters that are set for vm boot either</span>
<span class="sd">                    on the default cloud or the specified cloud.</span>

<span class="sd">                vm boot [options...]</span>
<span class="sd">                    Boots servers on a cloud, user may specify flavor, image</span>
<span class="sd">                    .etc, otherwise default values will be used, see how to set</span>
<span class="sd">                    default values of a cloud: cloud help</span>

<span class="sd">                vm start [options...]</span>
<span class="sd">                    Starts a suspended or stopped vm instance.</span>

<span class="sd">                vm stop [options...]</span>
<span class="sd">                    Stops a vm instance .</span>

<span class="sd">                vm delete [options...]</span>

<span class="sd">                    Delete servers of a cloud, user may delete a server by its</span>
<span class="sd">                    name or id, delete servers of a group or servers of a cloud,</span>
<span class="sd">                    give prefix and/or range to find servers by their names.</span>
<span class="sd">                    Or user may specify more options to narrow the search</span>

<span class="sd">                vm floating_ip_assign [options...]</span>
<span class="sd">                    assign a public ip to a VM of a cloud</span>

<span class="sd">                vm ip show [options...]</span>
<span class="sd">                    show the ips of VMs</span>

<span class="sd">                vm ssh [options...]</span>
<span class="sd">                    login to a server or execute commands on it</span>

<span class="sd">                vm list [options...]</span>
<span class="sd">                    same as command &quot;list vm&quot;, please refer to it</span>

<span class="sd">                vm status [options...]</span>
<span class="sd">                    Retrieves status of last VM booted on cloud and displays it.</span>

<span class="sd">                vm refresh [--cloud=CLOUDS]</span>
<span class="sd">                    this command refreshes the data for virtual machines,</span>
<span class="sd">                    images and flavors for the specified clouds.</span>

<span class="sd">                vm ping [NAMES] [--cloud=CLOUDS] [--count=N] [--processors=PROCESSORS]</span>
<span class="sd">                     pings the specified virtual machines, while using at most N pings.</span>
<span class="sd">                     The ping is executed in parallel.</span>
<span class="sd">                     If names are specifies the ping is restricted to the given names in</span>
<span class="sd">                     parameter format. If clouds are specified, names that are not in</span>
<span class="sd">                     these clouds are ignored. If the name is set in the variables</span>
<span class="sd">                     this name is used.</span>

<span class="sd">                cms vm ssh --command=\&quot;uname -a\&quot;</span>

<span class="sd">                      executes the uname command on the last booted vm</span>

<span class="sd">                vm script [--name=NAMES]</span>
<span class="sd">                          [--username=USERNAME]</span>
<span class="sd">                          [--key=KEY]</span>
<span class="sd">                          [--dryrun]</span>
<span class="sd">                          [--dir=DESTINATION]</span>
<span class="sd">                          [--shell=SHELL]</span>
<span class="sd">                          SCRIPT</span>

<span class="sd">                   The script command copies a shell script to the specified vms</span>
<span class="sd">                   into the DESTINATION directory and than execute it. With</span>
<span class="sd">                   SHELL you can set the shell for executing the command,</span>
<span class="sd">                   this coudl even be a python interpreter. Examples for</span>
<span class="sd">                   SHELL are /bin/sh, /usr/bin/env python</span>

<span class="sd">                vm put SOURCE DESTINATION [NAMES]</span>

<span class="sd">                    puts the file defined by SOURCE into the DESINATION folder</span>
<span class="sd">                    on the specified machines. If the file exists it is</span>
<span class="sd">                    overwritten, so be careful.</span>

<span class="sd">                vm get SOURCE DESTINATION [NAMES]</span>

<span class="sd">                    gets  the file defined by SOURCE into the DESINATION folder</span>
<span class="sd">                    on the specified machines. The SOURCE is on the remote</span>
<span class="sd">                    machine. If one machine is specified, the SOURCE is the same</span>
<span class="sd">                    name as on the remote machine. If multiple machines are</span>
<span class="sd">                    specified, the name of the machine will be a prefix to the</span>
<span class="sd">                    filename. If the filenames exists, they will be overwritten,</span>
<span class="sd">                    so be careful.</span>

<span class="sd">            Tip:</span>
<span class="sd">                give the VM name, but in a hostlist style, which is very</span>
<span class="sd">                convenient when you need a range of VMs e.g. sample[1-3]</span>
<span class="sd">                =&gt; [&#39;sample1&#39;, &#39;sample2&#39;, &#39;sample3&#39;]</span>
<span class="sd">                sample[1-3,18] =&gt; [&#39;sample1&#39;, &#39;sample2&#39;, &#39;sample3&#39;, &#39;sample18&#39;]</span>

<span class="sd">            Quoting commands:</span>
<span class="sd">                cm vm login gregor-004 --command=\&quot;uname -a\&quot;</span>

<span class="sd">            Limitations:</span>

<span class="sd">                Azure: rename is not supported</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">map_parameters</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span>
                       <span class="s1">&#39;active&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;cloud&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;command&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;dryrun&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;flavor&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;force&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;group&#39;</span>
                       <span class="s1">&#39;output&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;group&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;image&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;interval&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;ip&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;key&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;modify-knownhosts&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;n&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;public&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;quiet&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;secgroup&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;size&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;username&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;output&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;count&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;refresh&#39;</span><span class="p">)</span>

        <span class="n">variables</span> <span class="o">=</span> <span class="n">Variables</span><span class="p">()</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">CmDatabase</span><span class="p">()</span>

        <span class="n">arguments</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
                                          <span class="n">arguments</span><span class="p">,</span>
                                          <span class="n">variables</span><span class="p">,</span>
                                          <span class="s2">&quot;table&quot;</span><span class="p">)</span>

        <span class="n">arguments</span><span class="o">.</span><span class="n">refresh</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">find_bool</span><span class="p">(</span><span class="s2">&quot;refresh&quot;</span><span class="p">,</span>
                                                <span class="n">arguments</span><span class="p">,</span>
                                                <span class="n">variables</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">meta</span> <span class="ow">and</span> <span class="n">arguments</span><span class="o">.</span><span class="n">list</span><span class="p">):</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAME</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAME</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No vm specified&quot;</span><span class="p">)</span>

            <span class="n">cloud</span> <span class="o">=</span> <span class="s2">&quot;chameleon&quot;</span>
            <span class="c1"># cloud = Parameter.find(arguments, variables)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;vm metadata for </span><span class="si">{name}</span><span class="s2"> on </span><span class="si">{cloud}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cloud</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_server_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">meta</span> <span class="ow">and</span> <span class="n">arguments</span><span class="o">.</span><span class="n">set</span><span class="p">:</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;KEY=VALUE&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAME</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAME</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name</span><span class="o">=</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No vm specified&quot;</span><span class="p">)</span>

            <span class="n">cloud</span> <span class="o">=</span> <span class="s2">&quot;chameleon&quot;</span>
            <span class="c1">#cloud = Parameter.find(arguments, variables)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;cloud </span><span class="si">{cloud}</span><span class="s2"> </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cloud</span><span class="p">)</span>
            <span class="n">provider</span><span class="o">.</span><span class="n">set_server_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>  <span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_server_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">pprint</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">meta</span> <span class="ow">and</span> <span class="n">arguments</span><span class="o">.</span><span class="n">delete</span><span class="p">:</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;KEY&#39;</span><span class="p">]</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAME</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAME</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name</span><span class="o">=</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No vm specified&quot;</span><span class="p">)</span>

            <span class="n">cloud</span> <span class="o">=</span> <span class="s2">&quot;chameleon&quot;</span>
            <span class="c1">#cloud = Parameter.find(arguments, variables)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;cloud </span><span class="si">{cloud}</span><span class="s2"> </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cloud</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">provider</span><span class="o">.</span><span class="n">delete_server_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>


            <span class="n">r</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_server_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">pprint</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">list</span> <span class="ow">and</span> <span class="n">arguments</span><span class="o">.</span><span class="n">refresh</span><span class="p">:</span>

            <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">,</span>
                                                          <span class="n">arguments</span><span class="p">,</span>
                                                          <span class="n">variables</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;cloud </span><span class="si">{cloud}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cloud</span><span class="p">)</span>
                <span class="n">vms</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>

                <span class="n">provider</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">vms</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;vm&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>

            <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;list&quot;</span><span class="p">,</span>
                                                          <span class="n">arguments</span><span class="p">,</span>
                                                          <span class="n">variables</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;List </span><span class="si">{cloud}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
                    <span class="n">kind</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">kind</span>

                    <span class="n">collection</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{cloud}</span><span class="s2">-vm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cloud</span><span class="o">=</span><span class="n">cloud</span><span class="p">,</span>
                                                       <span class="n">kind</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
                    <span class="n">db</span> <span class="o">=</span> <span class="n">CmDatabase</span><span class="p">()</span>
                    <span class="n">vms</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>

                    <span class="n">p</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">vms</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;vm&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

                <span class="n">VERBOSE</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="k">return</span> <span class="s2">&quot;&quot;</span>


        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">ping</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm ping [NAMES] [--cloud=CLOUDS] [--count=N]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span><span class="p">:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;cloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]</span>
            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span>
                                                          <span class="n">arguments</span><span class="p">,</span>
                                                          <span class="n">variables</span><span class="p">)</span>

            <span class="n">count</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">count</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">count</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="c1"># gets public ips from database</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{cloud}</span><span class="s1">-vm&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">}):</span>
                        <span class="n">ips</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;public_ips&#39;</span><span class="p">]))</span>
                <span class="n">ips</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ips</span><span class="p">)</span>
                <span class="n">pprint</span> <span class="p">(</span><span class="n">ips</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ips</span><span class="p">:</span>
                <span class="n">Shell</span><span class="o">.</span><span class="n">ping</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">check</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm check [NAMES] [--cloud=CLOUDS] [--username=USERNAME]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            </span>
<span class="sd">            THIS IS ALL WRONG AS PROVIDER DEPENDENT !!!</span>
<span class="sd">            </span>
<span class="sd">            if arguments.NAMES:</span>
<span class="sd">                variables[&#39;vm&#39;] = arguments.NAMES</span>
<span class="sd">            if arguments[&#39;--cloud&#39;]:</span>
<span class="sd">                variables[&#39;cloud&#39;] = arguments[&#39;--cloud&#39;]</span>
<span class="sd">            clouds, names = Arguments.get_cloud_and_names(&quot;status&quot;, arguments, variables)</span>

<span class="sd">            for cloud in clouds:</span>
<span class="sd">                provider = Provider(cloud)</span>
<span class="sd">                params = {}</span>

<span class="sd">                params[&#39;key&#39;] = \</span>
<span class="sd">                    provider.p.spec[&quot;credentials&quot;][&#39;EC2_PRIVATE_KEY_FILE_PATH&#39;] + \</span>
<span class="sd">                    provider.p.spec[&quot;credentials&quot;][&#39;EC2_PRIVATE_KEY_FILE_NAME&#39;]</span>

<span class="sd">                params[&#39;username&#39;] = arguments[&#39;--username&#39;]  # or get from db</span>

<span class="sd">                processors = arguments[&#39;--processors&#39;]</span>
<span class="sd">                if processors:</span>
<span class="sd">                    params[&#39;processors&#39;] = int(processors[0])</span>

<span class="sd">                # gets public ips from database</span>
<span class="sd">                public_ips = []</span>
<span class="sd">                cursor = database.db[&#39;{cloud}-vm&#39;]</span>
<span class="sd">                for name in names:</span>
<span class="sd">                    for node in cursor.find({&#39;name&#39;: name}):</span>
<span class="sd">                        public_ips.append(node[&#39;public_ips&#39;])</span>
<span class="sd">                public_ips = [y for x in public_ips for y in x]</span>

<span class="sd">                Host.check(hosts=public_ips, **params)</span>
<span class="sd">            &quot;&quot;&quot;</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span><span class="p">:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;cloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]</span>
            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

            <span class="c1"># gets status from database</span>
            <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{cloud}</span><span class="s1">-vm&#39;</span><span class="p">]</span>
                <span class="nb">print</span> <span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">}):</span>
                        <span class="n">status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="n">provider</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>


        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
            <span class="c1"># TODO: not tested</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span><span class="p">:</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span>

            <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;cloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]</span>
            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

            <span class="n">cloud</span> <span class="o">=</span> <span class="n">clouds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">names</span><span class="p">)</span>


            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>

                <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--dryrun&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;start node </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vms</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">cloud</span><span class="o">=</span><span class="n">cloud</span><span class="p">)</span>

                    <span class="n">provider</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">vms</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;vm&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="c1"># TODO: not tested</span>

            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span><span class="p">:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;cloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]</span>
            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--dryrun&#39;</span><span class="p">]:</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">ok</span> <span class="p">(</span><span class="n">f</span><span class="s2">&quot;Dryrun stop: &quot;</span>
                                <span class="n">f</span><span class="s2">&quot;        </span><span class="si">{cloud}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="n">f</span><span class="s2">&quot;        </span><span class="si">{names}</span><span class="s2">&quot;</span>
                                <span class="n">f</span><span class="s2">&quot;        </span><span class="si">{provider}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                        <span class="n">vms</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                    <span class="n">provider</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">vms</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;vm&quot;</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">terminate</span><span class="p">:</span>
            <span class="c1"># TODO: not tested</span>

            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span><span class="p">:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;cloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]</span>
            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--dryrun&#39;</span><span class="p">]:</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">ok</span> <span class="p">(</span><span class="n">f</span><span class="s2">&quot;Dryrun terminate: &quot;</span>
                                <span class="n">f</span><span class="s2">&quot;        </span><span class="si">{cloud}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="n">f</span><span class="s2">&quot;        </span><span class="si">{names}</span><span class="s2">&quot;</span>
                                <span class="n">f</span><span class="s2">&quot;        </span><span class="si">{provider}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                        <span class="n">vms</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                    <span class="n">provider</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">vms</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;vm&quot;</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">delete</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span><span class="p">:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">NAMES</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]:</span>
                <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;cloud&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--cloud&#39;</span><span class="p">]</span>
            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">clouds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                    <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
                    <span class="n">vms</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">vms</span><span class="p">:</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">vm</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>

            <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
                <span class="n">vms</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">vms</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                    <span class="k">if</span>  <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>



        <span class="c1"># TODO: username, secgroup</span>
        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">boot</span><span class="p">:</span>
            <span class="c1"># not everything works</span>

            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                vm boot </span>
<span class="sd">                        [--name=VMNAMES]</span>
<span class="sd">                        [--cloud=CLOUD]</span>
<span class="sd">                        [--username=USERNAME]</span>
<span class="sd">                        [--image=IMAGE]</span>
<span class="sd">                        [--flavor=FLAVOR]</span>
<span class="sd">                        [--public]</span>
<span class="sd">                        [--secgroup=SECGROUP]</span>
<span class="sd">                        [--key=KEY]</span>
<span class="sd">                        [--group=GROUP]</span>
<span class="sd">                        [--dryrun]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># for name in names:</span>
            <span class="c1">#    node = p.create(name=name, size=flavor, image=image)</span>


            <span class="c1"># VERBOSE(arguments)</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">()</span>

            <span class="n">names</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">cloud</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;cloud&quot;</span><span class="p">,</span>
                                   <span class="n">arguments</span><span class="p">,</span>
                                   <span class="n">variables</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()[</span><span class="n">f</span><span class="s2">&quot;cloudmesh.cloud.</span><span class="si">{cloud}</span><span class="s2">.default&quot;</span><span class="p">]</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">,</span>
                                   <span class="n">arguments</span><span class="p">,</span>
                                   <span class="n">variables</span><span class="o">.</span><span class="n">dict</span><span class="p">(),</span>
                                    <span class="p">{</span><span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">})</span>


            <span class="n">parameters</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">()</span>

            <span class="n">parameters</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">name</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">groups</span>
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;flavor&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;secgroup&quot;</span><span class="p">]:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span>
                                   <span class="n">arguments</span><span class="p">,</span>
                                   <span class="n">variables</span><span class="o">.</span><span class="n">dict</span><span class="p">(),</span>
                                   <span class="n">defaults</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">guess_username</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

            <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cloud</span><span class="p">)</span>

            <span class="n">parameters</span><span class="o">.</span><span class="n">secgroup</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">secgroup</span> <span class="ow">or</span> <span class="s2">&quot;default&quot;</span>

            <span class="c1"># pprint(parameters)</span>

            <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--dryrun&#39;</span><span class="p">]:</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Dryrun stop: </span><span class="se">\n</span><span class="s2">&quot;</span>
                           <span class="n">f</span><span class="s2">&quot;        cloud=</span><span class="si">{cloud}</span><span class="se">\n</span><span class="s2">&quot;</span>
                           <span class="n">f</span><span class="s2">&quot;        names=</span><span class="si">{names}</span><span class="se">\n</span><span class="s2">&quot;</span>
                           <span class="n">f</span><span class="s2">&quot;        provide=</span><span class="si">{provider}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">ok</span> <span class="p">(</span><span class="n">f</span><span class="s2">&quot;        </span><span class="si">{attribute}</span><span class="s2">=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">)</span>




            <span class="k">else</span><span class="p">:</span>

                <span class="c1">#pprint (parameters)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">arguments</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">count</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="n">Name</span><span class="p">()</span>
                        <span class="n">n</span><span class="o">.</span><span class="n">incr</span><span class="p">()</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

                    <span class="c1"># parameters.progress = len(parameters.names) &lt; 2</span>

                    <span class="n">vms</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
                    <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;-v&quot;</span><span class="p">]:</span>
                        <span class="n">banner</span><span class="p">(</span><span class="s2">&quot;Details&quot;</span><span class="p">)</span>
                        <span class="n">pprint</span><span class="p">(</span><span class="n">vms</span><span class="p">)</span>

                <span class="c1"># provider.Print(arguments.output, &quot;vm&quot;, vms)</span>



        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm info [--cloud=CLOUD] [--output=OUTPUT]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;info for the vm&quot;</span><span class="p">)</span>

            <span class="n">cloud</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">rename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="c1"># Not tested</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rename the vm&quot;</span><span class="p">)</span>

            <span class="n">v</span> <span class="o">=</span> <span class="n">Variables</span><span class="p">()</span>
            <span class="n">cloud</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;cloud&quot;</span><span class="p">]</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">oldnames</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;OLDNAMES&quot;</span><span class="p">])</span>
                <span class="n">newnames</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;NEWNAMES&quot;</span><span class="p">])</span>
                <span class="n">force</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;--force&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">oldnames</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">newnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Wrong VMs specified for rename&quot;</span><span class="p">,</span>
                                  <span class="n">traceflag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldnames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newnames</span><span class="p">):</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The number of VMs to be renamed is wrong&quot;</span><span class="p">,</span>
                                  <span class="n">traceflag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">oldnames</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">newnames</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldnames</span><span class="p">)):</span>
                        <span class="n">oldname</span> <span class="o">=</span> <span class="n">oldnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">newname</span> <span class="o">=</span> <span class="n">newnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;--dryrun&quot;</span><span class="p">]:</span>
                            <span class="n">Console</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span>
                                <span class="s2">&quot;Rename </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oldname</span><span class="p">,</span> <span class="n">newname</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;rename </span><span class="si">{oldname}</span><span class="s2"> -&gt; </span><span class="si">{newname}</span><span class="s2">&quot;</span><span class="p">)</span>

                            <span class="n">p</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">oldname</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">newname</span><span class="p">)</span>

                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;info. OK.&quot;</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">Error</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Problem renaming instances&quot;</span><span class="p">,</span> <span class="n">traceflag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;show&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;show the ips&quot;</span><span class="p">)</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm ip show [NAMES]</span>
<span class="sd">                   [--group=GROUP]</span>
<span class="sd">                   [--cloud=CLOUD]</span>
<span class="sd">                   [--output=OUTPUT]</span>
<span class="sd">                   [--refresh]</span>

<span class="sd">            &quot;&quot;&quot;</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;assign&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm ip assign [NAMES] [--cloud=CLOUD]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;assign the public ip&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;inventory&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>


            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm ip inventory [NAMES]</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;list ips that could be assigned&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sets defaults for the vm&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">script</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_cloud_and_names</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--username&#39;</span><span class="p">]</span>
            <span class="n">script</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">SCRIPT</span>

            <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>

                <span class="n">name_ips</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-node&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cloud</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">}):</span>
                        <span class="n">name_ips</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s1">&#39;public_ips&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;--dryrun&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;run script </span><span class="si">{}</span><span class="s2"> on vms: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">names</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">provider</span><span class="o">.</span><span class="n">ssh</span><span class="p">(</span><span class="n">name_ips</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">username</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm username USERNAME [NAMES] [--cloud=CLOUD]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sets the username for the vm&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">resize</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm resize [NAMES] [--size=SIZE]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">ssh</span><span class="p">:</span>

            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm ssh [NAMES] [--username=USER]</span>
<span class="sd">                 [--quiet]</span>
<span class="sd">                 [--ip=IP]</span>
<span class="sd">                 [--key=KEY]</span>
<span class="sd">                 [--command=COMMAND]</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># VERBOSE(arguments)</span>
            <span class="n">clouds</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_commands</span><span class="p">(</span><span class="s2">&quot;ssh&quot;</span><span class="p">,</span>
                                                            <span class="n">arguments</span><span class="p">,</span>
                                                            <span class="n">variables</span><span class="p">)</span>

            <span class="c1"># print (clouds)</span>
            <span class="c1"># print(names)</span>
            <span class="c1"># print (command)</span>

            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Interactive shell can only be done on one vm&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cloud</span> <span class="o">=</span> <span class="n">clouds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cm</span> <span class="o">=</span> <span class="n">CmDatabase</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">find_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;vm&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;could not find vm </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
                <span class="c1"># VERBOSE(vm)</span>
                <span class="n">cloud</span> <span class="o">=</span> <span class="n">vm</span><span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">][</span><span class="s2">&quot;cloud&quot;</span><span class="p">]</span>
                <span class="n">provider</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cloud</span><span class="p">)</span>
                <span class="n">provider</span><span class="o">.</span><span class="n">ssh</span><span class="p">(</span><span class="n">vm</span><span class="o">=</span><span class="n">vm</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># command on all vms</span>

                <span class="k">if</span> <span class="n">clouds</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="n">clouds</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">Provider</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                            <span class="n">cm</span> <span class="o">=</span> <span class="n">CmDatabase</span><span class="p">()</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">vm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">find_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;vm&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="n">Console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;could not find vm </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">continue</span>
                            <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ssh</span><span class="p">(</span><span class="n">vm</span><span class="o">=</span><span class="n">vm</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">console</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="c1"># vm console [NAME] [--force]</span>

            <span class="n">names</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="n">get_names</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="c1"># r = vm.console(name,force=argument.force)</span>
                <span class="n">Console</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{label}</span><span class="s2"> </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;console&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">wait</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            vm wait [--cloud=CLOUD] [--interval=SECONDS]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;waits for the vm till its ready and one can login&quot;</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2019, Cloudmesh Community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>